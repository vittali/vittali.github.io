<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Red and Blue: Run Node-RED on the IBM bluemix cloud and receive sensor data from your things</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Red and Blue: Run Node-RED on the IBM bluemix cloud and receive sensor data from your things</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_terminology">1. Terminology</a>
<ul class="sectlevel2">
<li><a href="#_dashboards">1.1. Dashboards</a></li>
<li><a href="#_credential_hell">1.2. Credential hell</a></li>
</ul>
</li>
<li><a href="#_create_the_em_my_node_red_app_em_and_the_associated_infrastructure">2. Create the <em>My-Node-RED-App</em> and the associated infrastructure</a>
<ul class="sectlevel2">
<li><a href="#_create_the_application_and_the_database">2.1. Create the application and the database</a></li>
<li><a href="#_create_the_continuous_delivery_toolchain">2.2. Create the continuous delivery toolchain</a></li>
</ul>
</li>
<li><a href="#_create_the_my_iot_platform_service">3. Create the My-IoT-Platform service</a>
<ul class="sectlevel2">
<li><a href="#_generate_the_iot_platform_access_code">3.1. Generate the IOT Platform access code:</a></li>
<li><a href="#_configure_connection_security">3.2. Configure connection security</a></li>
<li><a href="#_configure_devices">3.3. Configure Devices</a></li>
</ul>
</li>
<li><a href="#_install_local_software">4. Install local software</a>
<ul class="sectlevel2">
<li><a href="#_node_red">4.1. Node-RED</a></li>
<li><a href="#_bluemix_cli">4.2. Bluemix CLI</a></li>
</ul>
</li>
<li><a href="#_instantiate_template_files">5. Instantiate template files</a>
<ul class="sectlevel2">
<li><a href="#_project_agnostic_files">5.1. Project agnostic files</a></li>
<li><a href="#pop">5.2. Project specific files</a></li>
</ul>
</li>
<li><a href="#_initialize_the_work_flow">6. Initialize the work flow</a>
<ul class="sectlevel2">
<li><a href="#_initialize_the_app">6.1. Initialize the app</a></li>
</ul>
</li>
<li><a href="#_develop_locally_deploy_remotely">7. Develop locally, Deploy remotely</a></li>
<li><a href="#_references">8. References</a>
<ul class="sectlevel2">
<li><a href="#_iot_tutorials">8.1. IoT tutorials</a></li>
<li><a href="#_iot_development_with_java">8.2. IoT development with Java</a></li>
<li><a href="#_iot_with_rest_api">8.3. IoT with REST API</a></li>
<li><a href="#_cloudant">8.4. Cloudant</a></li>
<li><a href="#_node_red_node_js">8.5. Node-RED &amp; Node.js</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>You have an embedded device like a microcontroller and you want to upload sensor data
to the internet. You also want to take actions depending on the data. You want to run from a cheap device powered by a
small lithium coin, in other words your device is severly resource restraint.
Of course, you also want a database to store sensor readings and a nice gui so that others can use your work.
You also know that setting up your own server and maintaining it is not worth the effort. So you want
a cloud service, more precisely a <em>free</em> cloud service.</p>
</div>
<div class="paragraph">
<p>In this tutorial we will create the required infrastructure and develop a small application with a
gui and a database backend accessible on the internet.
The project files can be cloned from this <a href="https://github.com/vittali/vittali.ch-gst.rb1">git repo</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="https://www.ibm.com/support/knowledgecenter/SSQP8H/iot/platform/reference/mqtt/index.html">MQTT messaging</a> protocol is a good fit for these requirements as it is lightweight and allows
for the required two-way communication. Devices can publish messages and subscribe to commands emitted by application.
<a href="https://cloud.ibm.com">IBM Bluemix</a> offers all the services we need based on the Lite Plan also known as the Free Plan.
I am not sure if I understand the difference between <em>IBM Cloud</em> and <em>IBM Bluemix</em>,
hereafter I will always refer to <em>Bluemix</em>. Bluemix provides <em>Cloud Foundry</em>, a Platform-as-a-Service infrastructure
that will allow us to run our application and a database without any installation chores. Bluemix also provides
the IBM Watson IoT Platform, hereafter referred to as <em>IoT Platform</em>. This is the central communication hub for our MQTT-enabled devices.</p>
</div>
<div class="paragraph">
<p><a href="https://nodered.org">Node-RED</a> is a programming environment specifically designed for IoT requirements. It is based
on javascript but for a simple application almost no coding required. It is very easy to set up
a fully functional gui and it is has excellent support for Bluemix.</p>
</div>
<div class="paragraph">
<p>Presuming you have now created an account on IBM Bluemix (the Lite/Free Plan is sufficient), this tutorial
will walk you through the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>get to know required terminology</p>
</li>
<li>
<p>get to know the credentials hell</p>
</li>
<li>
<p>set up a git repo where your code will reside</p>
</li>
<li>
<p>develop and test the application locally</p>
</li>
<li>
<p>deploy the application to bluemix</p>
</li>
<li>
<p>test your work from your desktop.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The application, also known as the <em>app</em> hereafter, is based on this <a href="https://developer.ibm.com/tutorials/iot-edge3">IBM developer tutorial</a> albeit in a simplified form.
The motivation for adopting the work flow discussed in this tutorial is derived from two post by Nick O&#8217;Leary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://knolleary.net/2018/06/01/creating-a-node-red-deployment-pipeline-to-ibm-cloud/">Creating a Node-RED deployment pipeline to IBM Cloud</a></p>
</li>
<li>
<p><a href="https://knolleary.net/2018/06/05/connecting-to-ibm-cloud-services-from-node-red">Connecting to IBM Cloud services from Node-RED</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main difference with respect to the first link is that Bluemix now provides an integrated Continuous Delivery Toolchain, which simplifies the setup.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminology">1. Terminology</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As far as this tutorial is concerned,
Bluemix offers <em>Cloud Foundry Services</em>, <em>Services</em> and allows us to develop
<em>Cloud Foundry Apps</em>.</p>
</div>
<div class="paragraph">
<p>This can be seen on the Dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/dashboard.png" alt="Dashboard">
</div>
<div class="title">Figure 1. The Bluemix Dashboard</div>
</div>
<div class="paragraph">
<p>More important for our work is the <em>Resource list</em> that you can open from the hamburger menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/resource-list-intro.png" alt="Resource list">
</div>
<div class="title">Figure 2. The Bluemix Resource list</div>
</div>
<div class="paragraph">
<p>Here you can see the items we are going to create in this tutorial:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Cloud Foundry Apps</em>: we will develop the <em>My-Node-Red-App</em>, a <a href="https://nodered.org">Node-RED</a> <em>flow</em>-based javascript application without writing a single line of code.</p>
</li>
<li>
<p>Cloud Foundry Services: we create the <em>My-IoT-Platform</em> service that acts as a MQTT broker, amongst other tasks.
In particular, here we configure MQTT communications between our devices and the database.</p>
</li>
<li>
<p>Cloud Foundry Services: we create the <em>My-Node-RED-App-cloudantNoSQLDB</em> database,
more precisely an alias to the underlying database service. This alias is created automatically.</p>
</li>
<li>
<p>Services: Bluemix creates <em>Cloudant-ay</em> as the underlying database service where we store sensor readings.
The name is choosen by Bluemix during setup. Your name will be different.</p>
</li>
<li>
<p>Services: Continuous Delivery: the toolchain service that we have enabled for the app.
It includes a git repo and a delivery pipeline that deploys our app each time we push to the repo.</p>
</li>
<li>
<p>Developer Tools: <em>My-Node-RED-App</em> represents the actual toolchain associated with the app.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_dashboards">1.1. Dashboards</h3>
<div class="paragraph">
<p>In addition to the initial Bluemix Dashboard ( which I found not useful for this tutorial), there is the IoT Platform dashboard and
the Cloudant database dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/IoT-dashboard-intro.png" alt="IoT Platform Dashboard">
</div>
<div class="title">Figure 3. The IoT Platform Dashboard</div>
</div>
<div class="paragraph">
<p>The IoT Platform Dashboard is used to create Device Types and Devices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/cloudant-dashboard-intro.png" alt="Cloudant Dashboard">
</div>
<div class="title">Figure 4. The Cloudant Dashboard</div>
</div>
<div class="paragraph">
<p>The Cloudant Dashboard will contain our sensor data.
The nodered database is created by Bluemix during setup.</p>
</div>
</div>
<div class="sect2">
<h3 id="_credential_hell">1.2. Credential hell</h3>
<div class="paragraph">
<p>One of the most intimidating aspects when using the cloud for the first time seems to be the avalanche
of credentials, passwords, access tokens, ids, and other access codes.</p>
</div>
<div class="paragraph">
<p><em>Access code</em> is a generic name I choose to refer to any kind of 'secret' that is required to use Bluemix and
the services it provides.
Here is a preview that should help to mitigate that onslaught.</p>
</div>
<table id="table1" class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Access codes</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Access Code</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Context</th>
<th class="tableblock halign-left valign-top">provided by</th>
<th class="tableblock halign-left valign-top">Why ?</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrgId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OrgId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IoT Platform Dashboard &#8594; top right corner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bluemix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required for MQTT communications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nhr9i3 (6 char string)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bluemix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IBM Cloud Api Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dashboard &#8594; Manage &#8594; Access IAM &#8594; IBM Cloud Api Keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bluemix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">required by the Continuous Delivery Toolchain service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pmt_DmpY_nL6ExU8FhAk5C4f4-l73no &lt;trunc&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IoT Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Api Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IoT Platform Dashboard &#8594; Apps &#8594; Generate API Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bluemix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqtt clients need these credentials to access the platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Key: a-m60i9s-gjv4sdf2t Auth Token: fiL1QgUEknggdfg88</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Authentification Token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IoT Platform Dashboard &#8594; Devices &#8594; Add Device &#8594; &#8230;&#8203;. &#8594; Device Authentification Token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqtt devices need this token to access the platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">git</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain &#8594; git &#8594; top right corner &#8594; Settings &#8594; SSH Keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh-keygen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">to clone and push the project&#8217;s repository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssh-rsa AAAAB3NzaC1yc2EA &lt;trunc&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VCAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VCAP_Services enironment variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My-Node-RED-App &#8594; Runtime &#8594; Environment variables &#8594; Export</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bluemix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">to be able to locally access remote services like the Cloudant database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{  "cloudantNoSQLDB": [ &lt;trunc&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NR-flow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node-RED credential secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pop">Project specific files</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">to decrypt <code>flow.json</code>, the file that defines a Node-RED application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NR-editor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node-RED editor access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pop">Project specific files</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">to access the editor and possibly change the flow.json file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username: admin, password: $2a$08$LUhxY &lt;trunc&gt;</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When you create an access code on Bluemix, copy and save it immediately. Some codes can&#8217;t be retrieved at a later stage.
Also, do not put these codes in the project&#8217;s repository.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the following we assume orgId = <strong>nhr9i3</strong>, your orgId will be different.
</td>
</tr>
</table>
</div>
<div id="Bac" class="paragraph">
<p>Create the Bluemix access code right now:</p>
</div>
<div class="paragraph">
<p><code>Dashboard → Manage → Access IAM → IBM Cloud Api Keys &#8594; Create an IBM Cloud API key</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_em_my_node_red_app_em_and_the_associated_infrastructure">2. Create the <em>My-Node-RED-App</em> and the associated infrastructure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter we will create three items:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the application itself,</p>
</li>
<li>
<p>the database used to store sensor data.</p>
</li>
<li>
<p>the build and deploy delivery toolchain</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
there are several Node-RED-Bluemix tutorials on the internet where the database also stores the Node-Red flow files.
This is suitable for a work flow where development is done remotely.
However, in the work flow discussed in this tutorial, all development is done
locally and the flow files are pushed to repository each time the application is modified.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_create_the_application_and_the_database">2.1. Create the application and the database</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not yet created a <a href="#Bac">Bluemix access code</a> do it now.</p>
</li>
<li>
<p>From the Bluemix Dashboard page, click on the <em>Catalog</em> menu.</p>
</li>
<li>
<p>From the Starter Kits Category, click on <em>Node-Red Starter</em></p>
</li>
<li>
<p>Enter the App name: <em>My-Node-RED-App</em></p>
</li>
<li>
<p>Selected Plan: <em>Lite</em></p>
</li>
<li>
<p>Select the <em>Cloudant</em> service to be connected to the app:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/select-cloudant.png" alt="Cloudant">
</div>
<div class="title">Figure 5. The Cloudant Service link</div>
</div>
<div class="paragraph">
<p>This brings us to the <em>Getting started</em> pane of the application&#8217;s dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/app.png" alt="App Dashboard">
</div>
<div class="title">Figure 6. The <em>My-Node-RED-App</em> Dashboard</div>
</div>
<div class="paragraph">
<p>We are now ready to activate Toolchain support.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_continuous_delivery_toolchain">2.2. Create the continuous delivery toolchain</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <em>Overview</em></p>
</li>
<li>
<p>on the bottom right <em>Continuous delivery</em> click on <em>Enable</em>.</p>
</li>
<li>
<p>in the <em>Repository Type</em> drop down menu, select <em>New</em>.</p>
</li>
<li>
<p>enter the <a href="#Bac">Bluemix access code</a></p>
</li>
<li>
<p>click on <em>Create</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You are looking at the dashboard of the Continuous Delivery Toolchain:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/toolchain.png" alt="Toolchain">
</div>
<div class="title">Figure 7. The Continuous Delivery Toolchain</div>
</div>
<div class="paragraph">
<p>Now, we need to get access to this repository:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>click on the Git tile.</p>
</li>
<li>
<p>set up your git access code using a public SSH key: <code>top right corner icon &#8594; Settings &#8594; SSH Keys</code></p>
</li>
<li>
<p>copy the link to the repository and clone it:</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/git.png" alt="Git">
</div>
<div class="title">Figure 8. The new empty repository for the app</div>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git clone git@eu-gb.git.cloud.ibm.com:&lt;your name&gt;/My-Node-RED-App.git</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the directory <em>My-Node-RED-App</em> into which we cloned the repository is called the <strong>project directory</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now go back to the application&#8217;s dashboard, then click on <code>Runtime &#8594; Environment variables
&#8594; VCAP_SERVICES &#8594; Export</code> to export this environment variable to
a file named <code>My-Node-RED-App_vcap.json</code> into the project directory.</p>
</div>
<div class="paragraph">
<p>This file now contains all the Bluemix specific data that we need to run our app locally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_the_my_iot_platform_service">3. Create the My-IoT-Platform service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you continue, I recommend the following two video tutorials prepared by IBM:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=vLMX9gyTEr4">An Introduction to the IBM Cloud - Part 1 - YouTube</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=OysQX0VwZEY">An Introduction to the IBM Cloud - Part 2 - YouTube</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and the following documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.ibm.com/docs/services/IoT?topic=iot-platform-getting-started">IoT Getting started tutorial</a></p>
</li>
<li>
<p><a href="https://cloud.ibm.com/docs/services/IoT?topic=iot-platform-connect_devices_apps_gw">Connection information for applications, devices, and gateways</a></p>
</li>
<li>
<p><a href="https://www.ibm.com/support/knowledgecenter/SSQP8H/iot/platform/devices/device_dev_index.html">Device development</a></p>
</li>
<li>
<p><a href="https://www.ibm.com/support/knowledgecenter/SSQP8H/iot/platform/reference/guardian/security_policies.html#set_up_policies.html">Configuring security policies</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While this seems to be a lot of effort to go through a getting-started tutorial, I found these documents to be
very clear and informative and I believe it is much easier to follow this tutorial after a least a cursory glance at these links.</p>
</div>
<div class="paragraph">
<p>On the Bluemix Dashboard, click on <code>Catalog &#8594; Internet of Things &#8594; Internet of Things Platform</code>
to create an instance of the IoT Platform service. Choose <em>My-IoT-Platform</em> as name.
 Once the instance has been created, you will get another dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/start-iot.png" alt="Git">
</div>
<div class="title">Figure 9. The dashboard of the <em>My-IoT-Platform</em> service instance</div>
</div>
<div class="sect2">
<h3 id="_generate_the_iot_platform_access_code">3.1. Generate the IOT Platform access code:</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on the <em>Launch</em> button.</p>
</li>
<li>
<p>On the IoT Platform Dashboard click on <em>Apps</em>, and on the top right corner click on <em>Generate Api Key</em>.</p>
</li>
<li>
<p>Leave the defaults and click <em>Generate Key</em>.</p>
</li>
<li>
<p>Copy the API Key and the Authentification Token right now because you won&#8217;t be able to see the again.</p>
</li>
</ol>
</div>
<div id="akat" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember: I refer to this pair of strings (API Key,Authentification Token)
as the <em>IoT Platform</em> access code, see <a href="#table1">Access codes</a>.
We will need it later when we modify the Node-RED flow application template file.
This allows us to access the remote Cloudant database when developing the app locally.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_connection_security">3.2. Configure connection security</h3>
<div class="paragraph">
<p>To simplify testing we change the default setting for connection security:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>in the IoT Dashboard, click on <code>Security &#8594; Connection Security</code> and edit the <em>Default Rule</em>.</p>
</li>
<li>
<p>in the <em>Default</em> drop down menu, select <em>TLS Optional</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that this is not recommended for a production environment.
The reason for this change is that the <code>mqtt</code> node.js module we use as test mqtt client doesn&#8217;t seem to use ssl out of the box
and I wanted to keep things as simple as possible.</p>
</div>
<div class="paragraph">
<p>See also <a href="https://www.ibm.com/support/knowledgecenter/SSQP8H/iot/platform/reference/guardian/security_policies.html#set_up_policies.html">Configuring security policies</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_devices">3.3. Configure Devices</h3>
<div class="paragraph">
<p>Device type creation and device creation is explained in the tutorial material mentioned at the beginning of this chapter
and I assume you know how to perform the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create a new DeviceType with name <em>nodejs-client</em></p>
</li>
<li>
<p>and a device of this type with name <em>nodejs-client-1</em></p>
</li>
<li>
<p>click until your are asked to provide a Device Authentication Token.</p>
</li>
</ol>
</div>
<div id="dat" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I refer to this token as <em>DAT</em> access code, see <a href="#table1">Access codes</a>. We will need it later when we
instantiate the mqtt client test program template.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
as usual, write down the access code, you can&#8217;t retrieve it from the dashboard once the page is closed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your dashboard should now look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/iot-dashboard.png" alt="IoT Platform Dashboard">
</div>
<div class="title">Figure 10. The IoT Platform Dashboard after device creation</div>
</div>
<div class="paragraph">
<p>You are now ready to add and modify the application project files. But before we do this, we will
install the required software to run Node-RED locally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_install_local_software">4. Install local software</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start to develop our app, we need to install the Node-RED stack as well as the
IBM Cloud (CLI).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This tutorial has been tested on Linux Mint 18.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_node_red">4.1. Node-RED</h3>
<div class="paragraph">
<p>There are many ways to install Node-RED. I choose the
<a href="https://github.com/nodesource/distributions/blob/master/README.md">following</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
$ sudo apt-get install -y nodejs
$ sudo npm install -g node-red <i class="conum" data-value="1"></i><b>(1)</b>
$ sudo npm install -g mqtt <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This might result in:
 <br>
<code>gyp ERR! stack Error: EACCES: permission denied, mkdir '/usr/lib/node_modules/node-red/node_modules/bcrypt/.node-gyp'</code>
 <br>
I used the <code>--unsafe-perm</code> option to fix the <a href="https://github.com/nodejs/node-gyp/issues/1619">problem</a>:
 <br>
<code>$ sudo npm install -g --unsafe-perm node-red</code>
 <br></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since the test client uses the <code>require</code> mechanism and you installed the <code>mqtt</code> module globally,
your <code>NODE_PATH</code> must include the global <code>node_modules</code> directory tree, for example:
 <br>
<code>export NODE_PATH=/usr/lib/node_modules</code>
 <br></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The later node module is required for the mqtt test client.</p>
</div>
<div class="paragraph">
<p>We also need <code>node-red-admin</code> to generate a password hash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sudo npm install -g node-red-admin</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bluemix_cli">4.2. Bluemix CLI</h3>
<div class="paragraph">
<p>The IBM Cloud Command Line Interface (CLI) is a tool that lets you monitor all aspects of
the remote infrastructure from your local terminal.
The most important function for this tutorial is the visualization of log files.</p>
</div>
<div class="paragraph">
<p>To install IBM Cloud CLI
<a href="https://cloud.ibm.com/docs/cli?topic=cloud-cli-getting-started">start here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instantiate_template_files">5. Instantiate template files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>My-Node-RED-App</em> consists of two sets of files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>files that are project agnostic and can be used without modification</p>
</li>
<li>
<p>templates files that needs to be populated with project specific data, mostly access codes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files are available in the <a href="https://bitbucket.org/pvittali/pvittali.gst.rb1/src/master/">pvittali.gst.rb1 repository</a>.</p>
</div>
<div class="sect2">
<h3 id="_project_agnostic_files">5.1. Project agnostic files</h3>
<div class="paragraph">
<p>These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>.bluemix/pipeline.yml</code>:  used by the Delivery pipeline of the Continuous Integration Toolchain.</p>
</li>
<li>
<p><code>flow.json</code>: the Node-RED application</p>
</li>
<li>
<p><code>package.json</code>: required by node.js</p>
</li>
<li>
<p><code>run-app.sh</code> and <code>run-client.sh</code>: shortcuts to run the app and the mqtt test client locally.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pop">5.2. Project specific files</h3>
<div class="paragraph">
<p>These files are provided as templates and require customisation:</p>
</div>
<table id="table2" class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. template files</caption>
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.gitignore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclude files from being committed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app name</code> &#8594; <code>My-Node-RED-App</code> since the file with VCAP
access code <code>My-Node-RED-App_vcap.json</code> is required only locally, and should not be exposed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">manifest.yml</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tells the remote deploy stage how to build and start the app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>app name</code> &#8594; <code>My-Node-RED-App</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">settings.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the Node-RED settings file, see the Node-RED documentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access codes: NR-flow, NR-editor, VCAP, see <a href="#table1">Access codes</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mqtt-client.js</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">used to publish messages and test the app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access codes: orgId, DAT and clientId</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The password property in the <code>settings.js</code> file for the NR-editor access code
should be a hash rather than a plain text string.</p>
</div>
<div class="paragraph">
<p>To generate the hash, do the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ node-red-admin hash-pw
Password: &lt;enter your NR-editor password&gt;
$2a$08$ufCvyA.kLcV4LRdCTLFsruX.ejTq1UkxiI4FLt3oLpXvs/J1dlGA.</pre>
</div>
</div>
<div class="paragraph">
<p><a id="NRp"></a>The result is the hash of your
NR-editor password that goes into <code>settings.js</code> as we will see in a minute.</p>
</div>
<div class="paragraph">
<p>Here are some hightlights of the required changes in the <code>My-Node-RED-App</code> project directory:</p>
</div>
<div class="listingblock">
<div class="title">manifest.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml" data-lang="yaml">  applications:
    - path: .
      name: My-Node-RED-App <i class="conum" data-value="1"></i><b>(1)</b>
      environment_json: {}
      memory: 256M
      instances: 1
      disk_quota: 1024M
      services:
        - My-Node-RED-App-cloudantNoSQLDB <i class="conum" data-value="2"></i><b>(2)</b>
      command:  node-red -s settings.js -u .</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>application name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>name of the connection between the app and the database.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">settings.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">// ...
var vcap = "My-Node-RED-App_vcap.json"; <i class="conum" data-value="1"></i><b>(1)</b>
// ...
credentialSecret: "My-Node-RED-AppCredential", <i class="conum" data-value="2"></i><b>(2)</b>
adminAuth: {
  type: "credentials",
  users: [{
    username: "admin", <i class="conum" data-value="3"></i><b>(3)</b>
    password: "$2a$08$LUhdfsdafgasggdfgdfgerferg", <i class="conum" data-value="4"></i><b>(4)</b>
    permissions: "*"
  }],
},</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The file name containing the VCAP access code environment variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The NR-flow accesscode. We choose <em>My-Node-RED-AppCredential</em>.
For production code replace this with an environment variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The NR-editor username access code. We choose <em>admin</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <a href="#NRp">NR-editor password access code</a> generated in the previous step.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you change the NR-flow access-code after the first time you run the app, there is - to my knowledge
- no other way to apply the change than deleting the ./node_module director inside the
project directory.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">mqtt-client.js</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript" data-lang="javascript">// ...
var client = mqtt.connect('mqtt://nhr9i3.messaging.internetofthings.ibmcloud.com', { <i class="conum" data-value="1"></i><b>(1)</b>
  "username": "use-token-auth",
  "password": "nodejs-client-1-token", <i class="conum" data-value="2"></i><b>(2)</b>
  "clientId": "d:nhr9i3:nodejs-client:nodejs-client-1" <i class="conum" data-value="3"></i><b>(3)</b>

})
// ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>assuming orgId is <strong>nhr9i3</strong>, yours will be different !</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <a href="#dat">DAT access code</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>client identifier: d:orgId:device_type:device</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With all these files in the project directory we can now finish the local installation and initialize the app.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initialize_the_work_flow">6. Initialize the work flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, now that <code>package.json</code> is in place, we can finish the installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ npm install</pre>
</div>
</div>
<div class="sect2">
<h3 id="_initialize_the_app">6.1. Initialize the app</h3>
<div class="paragraph">
<p>The first time we run the app, Node-RED will generate a credential file for <code>flow.json</code> named
<code>flow_cred.json</code>. This file contains sensitive data like the <a href="#akat">IoT Platform access code</a>.
The NR-flow access code is used by Node-RED to decrypt this file.</p>
</div>
<div class="paragraph">
<p>Run the app from the project directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./run-app.sh</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the username you provided in <code>settings.js</code> and the password
you supplied to the <code>node-red-admin hash-pw</code> command,
see <a href="#NRp">NR-editor password access code</a>.</p>
</div>
<div class="paragraph">
<p>Open the IBM IoT node and enter the <a href="#akat">IoT Platform access code</a>. Click on <em>Deploy</em>.
This will generate the credential file <code>flow_cred.json</code>.</p>
</div>
<div class="paragraph">
<p>Populate the repo, commit and push to Bluemix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ git add -A &amp;&amp; git commit
$ git push -u origin master</pre>
</div>
</div>
<div class="paragraph">
<p>Open the Delivery Pipeline of the <em>My-Node-RED-App</em> Toolchain dashboard:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/stage.png" alt="Deploy Stage">
</div>
<div class="title">Figure 11. The Delivery Pipelines shows the build-deploy process</div>
</div>
<div class="paragraph">
<p>While the build is running, log into the IBM Cloud CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ibmcloud login
API endpoint: https://cloud.ibm.com
Region: eu-gb
Email&gt; &lt;enter the email address you used to register with Bluemix&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>and set the endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ibmcloud target --cf</pre>
</div>
</div>
<div class="paragraph">
<p>After the build has finished, check the log from with IBM Cloud CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ibmcloud cf logs My-Node-RED-App --recent</pre>
</div>
</div>
<div class="paragraph">
<p>I advise you to check the log carefully the first time you run the app.
Note that the logs might not be available immediately after the build has finished,
this can take up to a minute.</p>
</div>
<div class="paragraph">
<p>Finally, lets check the connection between the app and the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ibmcloud cf services
name                              service           plan                bound apps        last operation
My-IoT-Platform                   iotf-service      iotf-service-free                     create succeeded
My-Node-RED-App-cloudantNoSQLDB   cloudantNoSQLDB   Lite                My-Node-RED-App   create succeeded</pre>
</div>
</div>
<div class="paragraph">
<p>Remember that
<em>My-Node-RED-App-cloudantNoSQLDB</em> is the service name that we provided to <code>manifest.yml</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_develop_locally_deploy_remotely">7. Develop locally, Deploy remotely</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Develop your application with the Node-RED editor simply
by selecting nodes and wiring them toegether.</p>
</div>
<div class="paragraph">
<p>Run the mqtt-client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./run-client.sh
20 Aug 01:24:03 - created client
20 Aug 01:24:03 - publishing
20 Aug 01:24:04 - published: 1
20 Aug 01:24:05 - published: 2
20 Aug 01:24:06 - published: 3
^C</pre>
</div>
</div>
<div class="paragraph">
<p>Go to the gui by appending <code>ui</code> to the url of the app.</p>
</div>
<div class="paragraph">
<p>Finally, commit and push to start the build-deploy process in the Delivery Pipeline.</p>
</div>
<div class="paragraph">
<p>When you open the app&#8217;s url, you will be directed to the gui straight away:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/gui.png" alt="gui">
</div>
<div class="title">Figure 12. The app running remotely</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">8. References</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_iot_tutorials">8.1. IoT tutorials</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.ibm.com/tutorials/category/iot/">IoT – IBM Developer</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_iot_development_with_java">8.2. IoT development with Java</h3>
<div class="ulist">
<ul>
<li>
<p><a id="r1"></a>[r1]: <a href="https://developer.ibm.com/tutorials/cl-mqtt-bluemix-iot-node-red-app/">Explore MQTT and the Internet of Things service – IBM Developer</a></p>
</li>
<li>
<p><a id="r2"></a>[r2]: <a href="https://github.com/watson-developer-cloud/java-sdk">watson-developer-cloud/java-sdk: :1st_place_medal: Java SDK to use the IBM Watson services</a></p>
</li>
<li>
<p><a id="r3"></a>[r3]: <a href="https://github.com/ibm-watson-iot/iot-java">ibm-watson-iot/iot-java: Client libraries and samples for connecting to IBM Watson IoT using Java</a></p>
</li>
<li>
<p><a id="r4"></a>[r4]: <a href="https://cloud.ibm.com/docs/services/IoT/reference?topic=iot-platform-api_overview#api_http?cm_mc_uid=17830945645815473099532&amp;cm_mc_sid_50200000=16394121565595004152">IBM Watson IoT Platform Organization Administration REST APIs</a></p>
</li>
<li>
<p><a id="r5"></a>[r5]: <a href="https://developer.ibm.com/recipes/tutorials/use-the-java-client-library-to-connect-to-the-ibm-internet-of-things-iot-foundation">IBM Watson IoT Platform OSHI Device Client</a></p>
</li>
<li>
<p><a id="r6"></a>[r6]: <a href="https://github.com/ibm-watson-iot/iot-java/tree/master/samples/oshi">IBM Watson IoT Platform Java SDK</a></p>
</li>
<li>
<p><a id="r7"></a>[r7]: <a href="https://developer.ibm.com/recipes/tutorials/multiple-iot-device-simulation-using-java-client-library/">Multiple IoT Device Registration &amp; Simulation Application</a></p>
</li>
<li>
<p><a id="r8"></a>[r8]: <a href="https://developer.ibm.com/answers/questions/165207/connecting-to-iot-internet-of-things-from-my-java/">Connecting to IOT (Internet Of Things) from my Java Program using REST Api</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_iot_with_rest_api">8.3. IoT with REST API</h3>
<div class="ulist">
<ul>
<li>
<p><a id="r11"></a>[r11]: <a href="https://docs.internetofthings.ibmcloud.com/apis/swagger/v0002/org-admin.html">IBM Watson IoT API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_cloudant">8.4. Cloudant</h3>
<div class="ulist">
<ul>
<li>
<p><a id="r21"></a>[r21]: <a href="https://cloud.ibm.com/docs/services/Cloudant/api?topic=cloudant-creating-an-ibm-cloudant-query">Creating an IBM Cloudant Query</a></p>
</li>
<li>
<p><a id="r22"></a>[r22]: <a href="https://github.com/cloudant/java-cloudant">the official Cloudant library for Java</a></p>
</li>
<li>
<p><a id="r21"></a>[r21]: <a href="https://cloud.ibm.com/docs/services/Cloudant/api?topic=cloudant-creating-an-ibm-cloudant-query">Creating an IBM Cloudant Query</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_node_red_node_js">8.5. Node-RED &amp; Node.js</h3>
<div class="ulist">
<ul>
<li>
<p><a id="r31"></a>[r31]: <a href="https://developer.ibm.com/recipes/tutorials/creating-a-multiple-output-function-in-nodered-2-minute-read/" class="bare">https://developer.ibm.com/recipes/tutorials/creating-a-multiple-output-function-in-nodered-2-minute-read/</a></p>
</li>
<li>
<p><a id="r32"></a>[r32]: <a href="http://noderedguide.com/node-red-lecture-3-example-3-2-using-the-switch-node-to-handle-a-json-object/" class="bare">http://noderedguide.com/node-red-lecture-3-example-3-2-using-the-switch-node-to-handle-a-json-object/</a></p>
</li>
<li>
<p><a id="r33"></a>[r33]: <a href="https://www.npmjs.com/package/mqtt">mqtt - npm</a></p>
</li>
<li>
<p><a id="r34"></a>[r34]: <a href="https://www.npmjs.com/package/reload">reload - npm</a></p>
</li>
<li>
<p><a id="r35"></a>[r35]: <a href="https://ibmcode-staging.us-east.containers.mybluemix.net/tutorials/learn-nodejs-node-with-cloudant-dbaas/">Learn Node.js, Unit 14: Node.js with Cloudant DBaaS – IBM Developer</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.9.1/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>